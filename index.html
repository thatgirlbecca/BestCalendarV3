<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Best Calendar v3</title>
	<link rel="icon" type="image/png" href="BestCalendarV3Favicon3.png">
	<link rel="stylesheet" href="styles.css?v=2">
	<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
	<script src="config.js"></script>
</head>
<body>
	<!-- Login Screen -->
	<div id="login-screen" style="display: none;">
		<div class="login-container">
			<h1>Calendar Login</h1>
			<form id="login-form" onsubmit="handleLogin(event)">
				<label for="login-email"><b>Email</b></label>
				<input type="email" id="login-email" placeholder="Enter your email" required autofocus autocomplete="off">
				<label for="login-password"><b>Password</b></label>
				<input type="password" id="login-password" placeholder="Enter password" required autocomplete="off">
				<button type="submit" class="btn-login">Login</button>
				<div id="login-error" class="login-error" style="display: none;"></div>
			</form>
		</div>
	</div>

	<div id="calendar" style="display: none;">
		<div id="calendar-header">
			<div id="header-left">
				<button id="month-prev" class="change-month">&lt;</button>
				<select id="view-selector" class="view-selector" onchange="handleViewChange()" title="Change View">
					<option value="month">Month</option>
					<option value="week">Week</option>
				</select>
				<button id="month-next" class="change-month">&gt;</button>
				<button id="today-button" class="open-button" onclick="goToToday()" style="display: none;">Today</button>
			</div>
			<div id="header-top">
				<h1 id="month">November 2025</h1>
			</div>
			<div id="header-controls">
				<button class="open-button" onclick="openForm()">+</button>
				<select class="nav-dropdown" onchange="handleNavigation(this)" title="Navigate">
					<option value="" selected>ğŸ“… Calendar</option>
					<option value="todo.html">ğŸ“ Todos</option>
					<option value="grocery.html">ğŸ›’ Grocery</option>
					<option value="GiftPlan.html">ğŸ GiftPlan</option>
				</select>
				<button id="logout-button" class="logout-button" onclick="handleLogout()" title="Logout">â›”</button>
			</div>
			<div id="month-year-picker" class="hidden" aria-hidden="true">
				<label for="year-select">Year</label>
				<select id="year-select"></select>
				<label for="month-select">Month</label>
				<select id="month-select" disabled></select>
				<div style="margin-top:8px; display:flex; gap:8px; justify-content:center;">
					<button id="picker-go" class="btn">Go</button>
					<button id="picker-cancel" class="btn cancel">Cancel</button>
				</div>
			</div>
        </div>
		<form id="event-form">
			<div class="form-popup" id="myForm">
				<button type="button" class="form-close-x" aria-label="Close" onclick="closeForm()">&times;</button>
		<h2>Event Form</h2>
		<label for="event-title"><b>Event Title</b></label>
		<input type="text" id="event-title" placeholder="Enter Event Title" required>

		<div class="date-inputs-container">
			<div class="date-input-group">
				<label for="event-date"><b>Start Date</b></label>
				<input type="date" id="event-date" required>
			</div>
			<div class="date-input-group">
				<label for="event-end-date"><b>End Date</b></label>
				<input type="date" id="event-end-date">
			</div>
		</div>

		<div class="time-inputs-container">
				<div class="time-input-group">
					<label for="event-time"><b>Start Time</b></label>
					<input type="time" id="event-time">
				</div>
				<div class="time-input-group" id="end-time-container" style="display: none;">
					<label for="event-end-time"><b>End Time</b></label>
					<input type="time" id="event-end-time">
				</div>
			</div>

		<div class="checkbox-row">
			<label for="add-end-time"><input type="checkbox" id="add-end-time"> End Time</label>
			<label for="all-day-event"><input type="checkbox" id="all-day-event"> All Day</label>
			<label for="repeat-event"><input type="checkbox" id="repeat-event"> Repeat</label>
		</div>

		<div id="recurrence-container" style="display: none;">
			<div class="recurrence-row">
				<div class="recurrence-field">
					<label for="recurrence-pattern"><b>Repeat Pattern</b></label>
					<select id="recurrence-pattern">
							<option value="">None</option>
							<option value="DAILY">Daily</option>
							<option value="WEEKLY">Weekly</option>
							<option value="MONTHLY">Monthly</option>
							<option value="MONTHLY_NTH">Monthly on nth Weekday</option>
							<option value="YEARLY">Yearly</option>
							<option value="CUSTOM_DAYS">Custom Days</option>
						</select>
					</div>

					<div class="recurrence-field recurrence-interval-field">
						<label for="recurrence-interval"><b>Every</b></label>
						<div style="display: flex; gap: 8px; align-items: center;">
							<input type="number" id="recurrence-interval" min="1" value="1" style="width: 80px;">
							<span id="interval-label">day(s)</span>
						</div>
					</div>
				</div>

					<div id="nth-weekday-container" style="display: none; margin: 12px 0;">
						<label for="nth-week"><b>Which week?</b></label>
						<select id="nth-week" style="width: 100%; margin-top: 4px;">
							<option value="1">1st</option>
							<option value="2">2nd</option>
							<option value="3">3rd</option>
							<option value="4">4th</option>
							<option value="-1">Last</option>
						</select>
						<label for="nth-weekday" style="margin-top: 8px;"><b>Which day?</b></label>
						<select id="nth-weekday" style="width: 100%; margin-top: 4px;">
							<option value="MON">Monday</option>
							<option value="TUE">Tuesday</option>
							<option value="WED">Wednesday</option>
							<option value="THU">Thursday</option>
							<option value="FRI">Friday</option>
							<option value="SAT">Saturday</option>
							<option value="SUN">Sunday</option>
						</select>
					</div>

					<div id="custom-days-container" style="display: none; margin: 12px 0;">
						<label><b>Repeat on:</b></label>
						<div style="display: flex; flex-wrap: wrap; gap: 8px; margin-top: 6px;">
							<label><input type="checkbox" class="day-checkbox" value="MON"> Mon</label>
							<label><input type="checkbox" class="day-checkbox" value="TUE"> Tue</label>
							<label><input type="checkbox" class="day-checkbox" value="WED"> Wed</label>
							<label><input type="checkbox" class="day-checkbox" value="THU"> Thu</label>
							<label><input type="checkbox" class="day-checkbox" value="FRI"> Fri</label>
							<label><input type="checkbox" class="day-checkbox" value="SAT"> Sat</label>
							<label><input type="checkbox" class="day-checkbox" value="SUN"> Sun</label>
						</div>
					</div>

					<div style="margin: 12px 0;">
						<label><b>End Recurrence:</b></label>
						<div style="margin-top: 6px;">
							<label style="display: block; margin-bottom: 4px;">
								<input type="radio" name="recurrence-end-type" value="none" checked> Never
							</label>
							<label style="display: flex; align-items: center; gap: 8px; margin-bottom: 8px;">
								<input type="radio" name="recurrence-end-type" value="date"> On date:
								<input type="date" id="recurrence-end-date" style="width: 150px;">
							</label>
							<label style="display: flex; align-items: center; gap: 8px;">
								<input type="radio" name="recurrence-end-type" value="count"> After:
								<input type="number" id="recurrence-count" min="1" value="10" style="width: 70px;">
								<span>occurrences</span>
							</label>
						</div>
					</div>
				</div>

				<label for="event-location"><b>Location</b></label>
				<input type="text" id="event-location" placeholder="Optional location">

			<label for="event-description"><b>Description</b></label>
			<textarea id="event-description" placeholder="Optional description" rows="3"></textarea>

			<input type="hidden" id="editing-event-id" value="">
			<input type="hidden" id="event-color" value="">
			
			<div class="form-buttons">
				<button type="submit" id="event-submit-btn" class="btn">Add Event</button>
				<button type="button" id="delete-event-btn" class="btn cancel" style="display: none;" onclick="deleteEventFromForm()">Delete</button>
				<button type="button" class="btn cancel" onclick="closeForm()">Close</button>
				<div class="color-picker-inline">
					<button type="button" id="color-picker-toggle" class="btn btn-color" aria-expanded="false">ğŸ¨</button>
					<div id="color-options" class="color-options hidden" role="listbox" aria-label="Choose event color"></div>
				</div>
			</div>
		</div>
		</form>
		<div id="weekdays-header">
			<div>Mon</div>
			<div>Tue</div>
			<div>Wed</div>
			<div>Thu</div>
			<div>Fri</div>
			<div>Sat</div>
			<div>Sun</div>
		</div>
		<div id="week-view-container" style="display: none;">
			<div id="timeline"></div>
			<div id="week-grid"></div>
		</div>
		<div id="calendar-body">
			
		</div>
	</div>
	<!-- Event detail modal -->
	<div id="event-detail-modal"></div>
	
	<!-- Todo Panel Toggle Button (desktop only) -->
	<button id="todo-panel-toggle" class="todo-panel-toggle" onclick="toggleTodoPanel()" title="Toggle Todo List">
		ğŸ“
	</button>
	
	<!-- Pull-out Todo Panel -->
	<div id="todo-panel" class="todo-panel">
		<div class="todo-panel-header">
			<h2>ğŸ“ Todo List</h2>
			<button class="todo-panel-close" onclick="closeTodoPanel()">&times;</button>
		</div>
		<div class="todo-panel-toolbar">
			<button class="todo-panel-add-btn" onclick="openAddTodoFromPanel()">+ Add Task</button>
			<button class="todo-panel-sort-btn" onclick="openTodoPanelSortMenu()">âš™ï¸ Sort</button>
		</div>
		<!-- Sort Menu Popup -->
		<div id="todo-panel-sort-menu" class="todo-panel-sort-menu" style="display: none;">
			<div class="todo-panel-sort-menu-content">
				<div class="todo-panel-sort-menu-header">
					<span>Sort Options</span>
					<button class="todo-panel-sort-menu-close" onclick="closeTodoPanelSortMenu()">&times;</button>
				</div>
				<div class="todo-panel-sort-row">
					<label>Sort by:</label>
					<select id="todo-panel-sort-select">
						<option value="importance">Priority</option>
						<option value="start_date">Start Date</option>
						<option value="due_date">Due Date</option>
						<option value="alphabetical">Alphabetical</option>
						<option value="recurring">Recurring</option>
					</select>
					<button id="todo-panel-sort-dir" class="todo-panel-sort-dir-btn" onclick="toggleTodoPanelSortDirection()" title="Toggle sort direction">â†‘</button>
				</div>
				<div class="todo-panel-sort-row">
					<label>Then by:</label>
					<select id="todo-panel-sort-select-secondary">
						<option value="">None</option>
						<option value="importance">Priority</option>
						<option value="start_date">Start Date</option>
						<option value="due_date">Due Date</option>
						<option value="alphabetical">Alphabetical</option>
						<option value="recurring">Recurring</option>
					</select>
					<button id="todo-panel-sort-dir-secondary" class="todo-panel-sort-dir-btn" onclick="toggleTodoPanelSortDirectionSecondary()" title="Toggle secondary sort direction">â†‘</button>
				</div>
				<div class="todo-panel-sort-actions">
					<button class="todo-panel-sort-apply" onclick="applyTodoPanelSort()">Apply</button>
				</div>
			</div>
		</div>
		<div class="todo-panel-tabs">
			<button class="todo-panel-tab active" data-view="today" onclick="switchTodoPanelView('today')">Today</button>
			<button class="todo-panel-tab" data-view="upcoming" onclick="switchTodoPanelView('upcoming')">Upcoming</button>
			<button class="todo-panel-tab" data-view="inbox" onclick="switchTodoPanelView('inbox')">Inbox</button>
		</div>
		<div id="todo-panel-list" class="todo-panel-list">
			<!-- Todos will be rendered here -->
		</div>
	</div>
	<div id="todo-panel-overlay" class="todo-panel-overlay" onclick="closeTodoPanel()"></div>
	
	<!-- Add Todo Modal (for panel) -->
	<div id="todo-panel-add-modal" class="todo-panel-add-modal" style="display: none;">
		<div class="todo-panel-add-content">
			<div class="todo-panel-add-header">
				<h2>Add Task</h2>
				<span class="close" onclick="closeTodoPanelAddModal()">&times;</span>
			</div>
			<form id="todo-panel-add-form" onsubmit="saveTodoPanelTask(event)">
				<div class="form-row">
					<label for="todo-panel-text">Task *</label>
					<input type="text" id="todo-panel-text" required placeholder="What needs to be done?">
				</div>
				<div class="form-row">
					<label for="todo-panel-description">Description</label>
					<textarea id="todo-panel-description" rows="3" placeholder="Add details..."></textarea>
				</div>
				<div class="form-row-split">
					<div class="form-col">
						<label for="todo-panel-start-date">Start Date</label>
						<input type="date" id="todo-panel-start-date">
					</div>
					<div class="form-col">
						<label for="todo-panel-due-date">Due Date</label>
						<input type="date" id="todo-panel-due-date">
					</div>
				</div>
				<div class="form-row">
					<label for="todo-panel-importance">Importance</label>
					<select id="todo-panel-importance">
						<option value="1">ğŸ”´ High (1)</option>
						<option value="2">ğŸŸ  Medium (2)</option>
						<option value="3">ğŸŸ¡ Low (3)</option>
						<option value="4" selected>âšª None (4)</option>
					</select>
				</div>
				<div class="form-row">
					<label for="todo-panel-labels">Labels (comma separated)</label>
					<input type="text" id="todo-panel-labels" placeholder="work, personal, urgent">
				</div>
				<div class="form-actions">
					<button type="button" class="btn-cancel" onclick="closeTodoPanelAddModal()">Cancel</button>
					<button type="submit" class="btn-save">Save</button>
				</div>
			</form>
		</div>
	</div>
	
	<!-- Todo Detail Modal (for panel) -->
	<div id="todo-panel-detail-modal" class="todo-panel-detail-modal" style="display: none;">
		<div class="todo-panel-detail-content">
			<div class="todo-panel-detail-header">
				<h2 id="todo-panel-detail-title"></h2>
				<span class="close" onclick="closeTodoPanelDetail()">&times;</span>
			</div>
			<div style="padding: 20px;">
				<div id="todo-panel-detail-content">
					<!-- Details will be populated here -->
				</div>
				<div class="todo-panel-detail-actions">
					   <div style="display: flex; gap: 10px; align-items: center;">
						   <label class="complete-task-checkbox" style="display: flex; align-items: center; gap: 8px; cursor: pointer; font-size: 16px;">
							   <input type="checkbox" id="todo-panel-detail-checkbox" onchange="toggleCompleteTodoPanelDetail()" style="width: 20px; height: 20px; cursor: pointer;">
							   <span id="todo-panel-detail-complete-label" class="todo-panel-detail-complete-label">Mark as Complete</span>
						   </label>
					   </div>
					   <div style="display: flex; gap: 10px; margin-top: 10px;">
						   <button class="todo-panel-detail-btn archive" onclick="archiveTodoPanelDetail()">ğŸ“¦ Archive</button>
						   <button class="todo-panel-detail-btn edit" onclick="editTodoPanelDetail()">âœï¸ Edit</button>
						   <button class="todo-panel-detail-btn delete" onclick="deleteTodoPanelDetail()">ğŸ—‘ï¸ Delete</button>
					   </div>
				</div>
			</div>
		</div>
	</div>
	
	<!-- Recurring Event Delete Dialog -->
	<div id="recurring-delete-dialog" class="recurring-delete-overlay" style="display: none;">
		<div class="recurring-delete-modal">
			<h2>Delete Recurring Event</h2>
			<p>This is a recurring event. What would you like to delete?</p>
			<div class="recurring-delete-buttons">
				<button class="recurring-delete-btn delete-single" onclick="confirmDeleteSingleOccurrence()">Delete This Occurrence Only</button>
				<button class="recurring-delete-btn delete-all" onclick="confirmDeleteAllOccurrences()">Delete All Occurrences</button>
				<button class="recurring-delete-btn cancel-delete" onclick="cancelRecurringDelete()">Cancel</button>
			</div>
		</div>
	</div>
	
	<script src="dayDetailsModal.js"></script>
	<script src="supabase.js"></script>
	<script src="calendar.js"></script>
	<script src="auth.js"></script>
</body>
</html>
