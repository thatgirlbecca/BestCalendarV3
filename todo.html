<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Todo List - Oakley Family</title>
	<link rel="icon" type="image/png" href="BestCalendarV3Favicon3.png">
	<link rel="stylesheet" href="todo.css">
	<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
	<script src="config.js"></script>
</head>
<body>
	<!-- Login Screen -->
	<div id="login-screen" style="display: none;">
		<div class="login-container">
			<h1>Todo Login</h1>
			<form id="login-form" onsubmit="handleLogin(event)">
				<label for="login-email"><b>Email</b></label>
				<input type="email" id="login-email" placeholder="Enter your email" required autofocus autocomplete="off">
				<label for="login-password"><b>Password</b></label>
				<input type="password" id="login-password" placeholder="Enter password" required autocomplete="off">
				<button type="submit" class="btn-login">Login</button>
				<div id="login-error" class="login-error" style="display: none;"></div>
			</form>
		</div>
	</div>

	<!-- Todo App -->
	<div id="todo-app" style="display: none;">
		<div id="todo-header">
			<h1>ğŸ“ Todo List</h1>
			<div class="header-buttons">
				<select class="nav-dropdown" onchange="handleNavigation(this)" title="Navigate">
					<option value="index.html">ğŸ“… Calendar</option>
					<option value="" selected>ğŸ“ Todos</option>
					<option value="grocery.html">ğŸ›’ Grocery</option>
				</select>
				<button id="logout-button" class="logout-button" onclick="handleLogout()" title="Logout">â›”</button>
			</div>
		</div>

		<div id="todo-main">
			<!-- Sidebar for views -->
			<div id="todo-sidebar">
				<div class="view-section">
					<button class="view-btn active" data-view="today" onclick="switchView('today')">
						<span class="view-icon">ğŸ“…</span>
						<span class="view-text">Today</span>
					</button>
					<button class="view-btn" data-view="upcoming" onclick="switchView('upcoming')">
						<span class="view-icon">ğŸ“†</span>
						<span class="view-text">Upcoming</span>
					</button>
					<button class="view-btn" data-view="inbox" onclick="switchView('inbox')">
						<span class="view-icon">ğŸ“¥</span>
						<span class="view-text">Inbox</span>
					</button>
					<button class="view-btn" data-view="archive" onclick="switchView('archive')">
						<span class="view-icon">ğŸ“¦</span>
						<span class="view-text">Archive</span>
					</button>
				</div>
			</div>

			<!-- Main content area -->
			<div id="todo-content">
				<div id="todo-view-header">
					<button id="add-todo-btn" class="add-btn" onclick="openTodoForm()">+ Add Todo</button>
					<h2 id="view-title">Inbox</h2>
					<div class="sort-controls">
						<button id="sort-menu-btn" class="sort-menu-btn" onclick="openSortMenu()">âš™ï¸ Sort</button>
						<label>Sort by:</label>
						<select id="sort-select" onchange="updateSort()">
							<option value="start_date">Start Date</option>
							<option value="due_date">Due Date</option>
							<option value="importance">Priority</option>
							<option value="recurring">Recurring</option>
							<option value="alphabetical">Alphabetical</option>
						</select>
						<button id="sort-direction-btn" class="sort-direction-btn" onclick="toggleSortDirection()" title="Toggle sort direction">
							â†‘
						</button>
						<label style="margin-left: 10px;">Then by:</label>
						<select id="sort-select-secondary" onchange="updateSort()">
							<option value="">None</option>
							<option value="start_date">Start Date</option>
							<option value="due_date">Due Date</option>
							<option value="importance">Priority</option>
							<option value="recurring">Recurring</option>
							<option value="alphabetical">Alphabetical</option>
						</select>
						<button id="sort-direction-btn-secondary" class="sort-direction-btn" onclick="toggleSortDirectionSecondary()" title="Toggle secondary sort direction">
							â†‘
						</button>
					</div>
				</div>

				<div id="todo-list">
					<!-- Todos will be rendered here -->
				</div>
			</div>
		</div>
	</div>

	<!-- Todo Form Modal -->
	<div id="todo-modal" class="modal" style="display: none;">
		<div class="modal-content todo-modal-content">
			<div class="modal-header">
				<h2 id="modal-title">Add Todo</h2>
				<span class="close" onclick="closeTodoForm()">&times;</span>
			</div>
			<form id="todo-form" onsubmit="saveTodo(event)">
				<div class="form-row">
					<label for="todo-text">Task *</label>
					<input type="text" id="todo-text" required placeholder="What needs to be done?">
				</div>

				<div class="form-row">
					<label for="todo-description">Description</label>
					<textarea id="todo-description" rows="3" placeholder="Add details..."></textarea>
				</div>

				<div class="form-row-split">
					<div class="form-col">
						<label for="todo-start-date">Start Date</label>
						<input type="date" id="todo-start-date">
					</div>
					<div class="form-col">
						<label for="todo-due-date">Due Date</label>
						<input type="date" id="todo-due-date">
					</div>
				</div>

				<div class="form-row">
					<label for="todo-importance">Importance</label>
					<select id="todo-importance">
						<option value="1">ğŸ”´ High (1)</option>
						<option value="2">ğŸŸ  Medium (2)</option>
						<option value="3">ğŸŸ¡ Low (3)</option>
						<option value="4" selected>âšª None (4)</option>
					</select>
				</div>

				<div class="form-row">
					<label for="todo-labels">Labels (comma separated)</label>
					<input type="text" id="todo-labels" placeholder="work, personal, urgent">
				</div>

				<div class="form-row">
					<label>
						<input type="checkbox" id="todo-recurring"> Recurring Task
					</label>
				</div>

				<div id="recurrence-section" style="display: none;">
					<div class="form-row">
						<label for="todo-recurrence-type">Recurrence Type</label>
						<select id="todo-recurrence-type">
							<option value="schedule">On Schedule (fixed dates, like "every Wednesday")</option>
							<option value="after_completion">After Completion (e.g., "3 days after I complete it")</option>
						</select>
					</div>

					<div class="form-row">
						<label for="todo-recurrence-rule">Repeat</label>
						<select id="todo-recurrence-rule">
							<option value="DAILY">Daily</option>
							<option value="WEEKLY">Weekly</option>
							<option value="MONTHLY">Monthly</option>
							<option value="YEARLY">Yearly</option>
							<option value="CUSTOM_DAYS">Custom Days</option>
						</select>
					</div>

					<div class="form-row">
						<label for="todo-recurrence-interval">Every</label>
						<input type="number" id="todo-recurrence-interval" min="1" value="1">
						<span id="interval-label">day(s)</span>
					</div>

					<div id="custom-days-section" style="display: none;">
						<label>Days of Week</label>
						<div class="checkbox-row">
							<label><input type="checkbox" value="Sunday"> Sun</label>
							<label><input type="checkbox" value="Monday"> Mon</label>
							<label><input type="checkbox" value="Tuesday"> Tue</label>
							<label><input type="checkbox" value="Wednesday"> Wed</label>
							<label><input type="checkbox" value="Thursday"> Thu</label>
							<label><input type="checkbox" value="Friday"> Fri</label>
							<label><input type="checkbox" value="Saturday"> Sat</label>
						</div>
					</div>

					<div class="form-row">
						<label>End After</label>
						<div style="display: flex; gap: 10px; align-items: center;">
							<label style="display: flex; align-items: center; gap: 4px;">
								<input type="radio" name="recurrence-end-type" value="never" checked> Never
							</label>
							<label style="display: flex; align-items: center; gap: 4px;">
								<input type="radio" name="recurrence-end-type" value="date"> On Date
							</label>
							<label style="display: flex; align-items: center; gap: 4px;">
								<input type="radio" name="recurrence-end-type" value="count"> After
							</label>
						</div>
					</div>

					<div class="form-row" id="recurrence-end-date-section" style="display: none;">
						<label for="todo-recurrence-end">End Date</label>
						<input type="date" id="todo-recurrence-end">
					</div>

					<div class="form-row" id="recurrence-count-section" style="display: none;">
						<label for="todo-recurrence-count">Number of Occurrences</label>
						<input type="number" id="todo-recurrence-count" min="1" value="10" placeholder="e.g., 10">
					</div>
				</div>

				<div class="form-actions">
					<button type="button" class="btn-cancel" onclick="closeTodoForm()">Cancel</button>
					<button type="submit" class="btn-save">Save</button>
				</div>
			</form>
		</div>
	</div>

	<!-- Sort Options Modal -->
	<div id="sort-modal" class="modal" style="display: none;">
		<div class="modal-content sort-modal-content">
			<div class="modal-header">
				<h2>Sort Options</h2>
				<span class="close" onclick="closeSortMenu()">&times;</span>
			</div>
			<div style="padding: 20px;">
				<div class="form-row-split">
					<div style="flex: 1;">
						<label for="sort-select-modal">Sort by:</label>
						<select id="sort-select-modal">
							<option value="start_date">Start Date</option>
							<option value="due_date">Due Date</option>
							<option value="importance">Priority</option>
							<option value="recurring">Recurring</option>
							<option value="alphabetical">Alphabetical</option>
						</select>
					</div>
					<div style="display: flex; flex-direction: column; justify-content: flex-end;">
						<button id="sort-direction-modal-btn" class="sort-direction-btn" onclick="toggleModalSortDirection()" title="Toggle sort direction">
							â†‘
						</button>
					</div>
				</div>
				<div class="form-row-split">
					<div style="flex: 1;">
						<label for="sort-select-secondary-modal">Then by:</label>
						<select id="sort-select-secondary-modal">
							<option value="">None</option>
							<option value="start_date">Start Date</option>
							<option value="due_date">Due Date</option>
							<option value="importance">Priority</option>
							<option value="recurring">Recurring</option>
							<option value="alphabetical">Alphabetical</option>
						</select>
					</div>
					<div style="display: flex; flex-direction: column; justify-content: flex-end;">
						<button id="sort-direction-secondary-modal-btn" class="sort-direction-btn" onclick="toggleModalSecondarySortDirection()" title="Toggle secondary sort direction">
							â†‘
						</button>
					</div>
				</div>
				<div class="form-actions">
					<button type="button" class="btn-cancel" onclick="closeSortMenu()">Cancel</button>
					<button type="button" class="btn-save" onclick="applySortFromModal()">Apply</button>
				</div>
			</div>
		</div>
	</div>

	<!-- Todo Detail Modal -->
	<div id="todo-detail-modal" class="modal" style="display: none;">
		<div class="modal-content">
			<div class="modal-header">
				<h2 id="todo-detail-title"></h2>
				<span class="close" onclick="closeTodoDetail()">&times;</span>
			</div>
			<div style="padding: 20px;">
				<div id="todo-detail-content">
					<!-- Details will be populated here -->
				</div>
			<div class="modal-actions" style="display: flex; flex-direction: column; gap: 10px; margin-top: 20px; padding-top: 20px; border-top: 1px solid #444;">
				<div style="display: flex; gap: 10px;">
					<button class="modal-action-btn modal-edit-new" onclick="editTodoFromDetail()">âœï¸ Edit</button>
				</div>
				<div style="display: flex; gap: 10px;">
					<button class="modal-action-btn modal-archive" onclick="archiveTodoFromDetail()"></button>
					<button class="modal-action-btn modal-delete" onclick="deleteTodoFromDetail()">ğŸ—‘ï¸ Delete</button>
				</div>
			</div>
			</div>
		</div>
	</div>

	<script src="supabase.js"></script>
	<script src="todo.js"></script>
	<script src="auth.js"></script>
</body>
</html>
